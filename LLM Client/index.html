<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PPT Generator UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        #log {
            background: #111;
            color: #0f0;
            padding: 10px;
            height: 250px;
            overflow-y: scroll;
            white-space: pre-wrap;
            font-family: monospace;
            border-radius: 5px;
        }
        input, button {
            padding: 10px;
            margin: 5px 0;
            font-size: 16px;
        }
        button {
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>PPT Generator ‚Äì WebSocket UI</h1>

    <label>Upload Resume PDF:</label><br>
    <input id="pdfUpload" type="file" accept="application/pdf"><br><br>

    <button onclick="uploadAndGenerate()">Generate PPT</button>

    <h3>Logs:</h3>
    <div id="log"></div>

    <script>
        let ws;

        function log(msg) {
            const logBox = document.getElementById("log");
            logBox.textContent += msg + "\n";
            logBox.scrollTop = logBox.scrollHeight;
        }

        // ------------------------------
        // CONNECT TO WEBSOCKET (3001)
        // ------------------------------
        function connectWS() {
            ws = new WebSocket("ws://localhost:3001");

            ws.onopen = () => log("üü¢ WebSocket connected (3001).");
            ws.onmessage = (msg) => log("üì© WS Log: " + msg.data);
            ws.onerror = (err) => log("‚ùå WS Error: " + err);
            ws.onclose = () => log("üî¥ WS Disconnected.");
        }

        connectWS();

        // ------------------------------
        // Upload PDF -> Trigger PPT Generation
        // ------------------------------
        async function uploadAndGenerate() {
            const fileInput = document.getElementById("pdfUpload");

            if (fileInput.files.length === 0) {
                return alert("Please upload a PDF first!");
            }

            const pdfFile = fileInput.files[0];
            const formData = new FormData();
            formData.append("resume", pdfFile);

            log("üì§ Uploading PDF to http://localhost:3000/upload-pdf ...");

            try {
                const response = await fetch("http://localhost:3000/upload-pdf", {
                    method: "POST",
                    body: formData
                });

                const result = await response.json();
                log("üì© API (3000) Response: " + JSON.stringify(result));

                // After upload success ‚Üí trigger WS generation
                const payload = {
                    action: "generate_ppt"
                };

                ws.send(JSON.stringify(payload));
                log("üì§ Sent to WS (3001): " + JSON.stringify(payload));

            } catch (err) {
                log("‚ùå Upload Error: " + err);
            }
        }

    </script>

</body>
</html>
